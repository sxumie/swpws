<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwapWise - Home</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="carousel.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  
  <header class="main-header">
    <div class="nav-container">
      <div class="logo-area">
        <a href="#landing" class="brand-logo">SwapWise</a>
      </div>
  
      <div class="nav-links-group">
        <button class="nav-icon-btn" onclick="window.location.href='swappingprocess.html'" title="Active Swaps">
          ü§ù
        </button>
  
        <div class="noti-wrapper" id="notiWrapper">
          <button class="nav-icon-btn noti-btn" id="notiBellBtn" title="Notifications">
              üîî
              <span id="nav-red-dot" class="notification-badge hidden"></span>
          </button>
          
          <div id="notiHoverBox" class="noti-hover-dropdown">
            <div class="noti-hover-header">
                <span>Recent Activity</span>
                <button id="clearAllBtn" class="btn-text-tiny" onclick="markAllAsRead()">Mark all as read</button>
            </div>
            <div id="notiHoverList" class="noti-hover-list">
                </div>
            <button class="noti-view-all" onclick="window.location.href='notification.html'">View All Inbox</button>
        </div>
      </div>
  
        <button class="nav-icon-btn theme-toggle" onclick="toggleTheme()" title="Change Mode">
          üåì
        </button>
  
        <div id="userLinks" class="hidden profile-area">
          <button class="user-avatar-trigger" onclick="toggleProfileMenu()">
            <img id="headerAvatarImg" src="images/coco.jpg" alt="User">
          </button>
          
          <div id="profileMenu" class="user-dropdown-box hidden">
            <button onclick="openProfileFromMenu()">Profile</button>
            <div class="menu-divider"></div>
            <button onclick="logout()" class="logout-text">Logout</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main id="landing">
    <section class="hero">
        <div class="hero-content">
            <h1>Welcome to SwapWise!<br><span id="welcomeName" class="gradient-text">Student</span></h1>
            <p>Ready to trade some more skills today?</p>
        </div>
    </section>

    <section id="activeSwapsSection" class="dashboard-section hidden">
      <div class="dash-header">
          <h2>Active Swaps</h2>
      </div>
      <div id="activeSwapsContainer" class="matches">
          </div>
    </section>

    <section id="community-carousel" class="carousel-container">
      <h2>Meet Our Community</h2>
      
      <div class="carousel-viewport">
          <div id="carouselTrack" class="carousel-track"></div>
      </div>
  
      <div class="carousel-controls">
          <button class="control-btn" onclick="moveCarousel(-1)" aria-label="Previous">‚ùÆ</button>
          <button class="control-btn" onclick="moveCarousel(1)" aria-label="Next">‚ùØ</button>
      </div>
  </section>
</main>





<section id="dashboard" class="hidden">
    <div class="dashboard-section">
        <div class="dash-header">
            <h2>Hello, <span id="userNameDisplay" style="background: var(--gradient-purple); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></span>!</h2>
            <input class="search" type="search" placeholder="Search skills..." onkeyup="search(this.value)" />
        </div>
        <h3 style="margin-bottom: 1.5rem; font-size: 1.5rem; font-weight: 700;">Available Teachers</h3>
        <div class="matches" id="matchesContainer"></div>
    </div>
</section>

  <section id="profile" class="hidden">
    <div class="profile-container">
      <div id="profileView" class="profile-card">
        <div class="profile-header">
          <div class="profile-avatar-wrapper">
            <img id="userAvatar" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><g fill='%23fff'><circle cx='32' cy='20' r='10'/><path d='M8 54c0-10 10-18 24-18s24 8 24 18z'/></g></svg>" alt="Avatar" />
          </div>
          <h2 id="viewName" class="profile-name"></h2>
          <p id="viewBio" class="profile-bio"></p>
        </div>
        
        <div class="profile-info">
          <div class="info-item">
            <div class="info-icon">üéØ</div>
            <div class="info-content">
              <span class="info-label">Skills</span>
              <span id="viewSkill" class="info-value"></span>
            </div>
          </div>
          <div class="info-item">
            <div class="info-icon">üìÖ</div>
            <div class="info-content">
              <span class="info-label">Age</span>
              <span id="viewAge" class="info-value"></span>
            </div>
          </div>
          <div class="info-item">
            <div class="info-icon">üéÇ</div>
            <div class="info-content">
              <span class="info-label">Birthday</span>
              <span id="viewBirthday" class="info-value"></span>
            </div>
          </div>
          <div class="info-item">
            <div class="info-icon">üéì</div>
            <div class="info-content">
              <span class="info-label">School</span>
              <span id="viewSchool" class="info-value"></span>
            </div>
          </div>
        </div>

        <div class="profile-actions">
          <button class="btn-primary" onclick="showEditProfile()">Edit Profile</button>
          <button class="btn-outline" onclick="showDashboard()">‚Üê Back</button>
        </div>
      </div>

      <div id="profileEdit" class="profile-card hidden">
        <div class="edit-header">
          <h2>Edit Profile</h2>
        </div>
        
        <div class="edit-avatar-section">
          <div class="edit-avatar-wrapper">
            <img id="editAvatarPreview" src="" alt="Avatar preview" />
            <label for="avatarUploadEdit" class="avatar-overlay">
              <span>üì∑</span>
            </label>
          </div>
          <input type="file" id="avatarUploadEdit" accept="image/*" onchange="updateAvatar(event)" class="hidden" />
          <button class="btn-text" type="button" onclick="resetAvatarToDefault()">Reset to default</button>
        </div>

        <div class="edit-form">
          <div class="form-group">
            <label for="editName">Name</label>
            <input id="editName" type="text" placeholder="Your name" />
          </div>
          <div class="form-group">
            <label for="editBio">Bio</label>
            <textarea id="editBio" placeholder="Tell us about yourself..." rows="3"></textarea>
          </div>
          <div class="form-group">
            <label for="editSkill">Skills</label>
            <input id="editSkill" type="text" placeholder="e.g. Coding, Design, Math" />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="editAge">Age</label>
              <input id="editAge" type="number" min="0" placeholder="Age" />
            </div>
            <div class="form-group">
              <label for="editBirthday">Birthday</label>
              <input id="editBirthday" type="date" />
            </div>
          </div>
          <div class="form-group">
            <label for="editSchool">School</label>
            <input id="editSchool" type="text" placeholder="School Name" />
          </div>
          <div class="form-group">
            <label for="editPassword">New Password</label>
            <input id="editPassword" type="password" placeholder="Password" />
          </div>
        </div>

        <div class="profile-actions">
          <button class="btn-primary" onclick="saveProfile()">üíæ Save Changes</button>
          <button class="btn-outline" onclick="cancelEditProfile()">Cancel</button>
        </div>
      </div>
    </div>
  </section>
</section>

  <footer>¬© 2026 SwapWise. Trade skills, build futures.</footer>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="script.js"></script>
  <script src="carousel.js"></script>

  <script>
    window.addEventListener('load', () => {
    const user = JSON.parse(localStorage.getItem('swapwiseUser'));
    if (user) {
        // Start the listener
        initRealtimeNotifications();
        // Do initial check
        checkNewNotifications();
    }

    // Wait 100ms to ensure script.js has defined the functions
    setTimeout(() => {
        if (typeof loadDashboard === 'function') {
            loadDashboard(user);
            checkNewNotifications();
        }
    }, 100);
});
</script>
</body>
</html>